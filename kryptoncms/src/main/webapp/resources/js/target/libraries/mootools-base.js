define(["jquery"],function(e){function i(e){if(e.item){var t=e.length,n=new Array(t);while(t--)n[t]=e[t];return n}return Array.prototype.slice.call(e)}function s(e){return function(){return arguments[e]}}function o(e){return!!e||e===0}function u(e){return clearTimeout(e),clearInterval(e),null}function a(e){return e!=undefined}function f(e,t,n){var i=E(e);(i=="arguments"||i=="collection"||i=="array"?Array:r).each(e,t,n)}function l(){}function c(e,t){for(var n in t||{})e[n]=t[n];return e}function h(e){return new r(e)}function p(e){return E(e)=="function"?e:function(){return e}}function d(){var e=Array.slice(arguments);return e.unshift({}),v.apply(null,e)}function v(e){for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(E(r)!="object")continue;for(var i in r){var s=r[i],o=e[i];e[i]=o&&E(s)=="object"&&E(o)=="object"?v(o,s):S(s)}}return e}function m(){for(var e=0,t=arguments.length;e<t;e++)if(arguments[e]!=undefined)return arguments[e];return null}function g(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function y(e){var t=E(e);return t?t!="array"&&t!="arguments"?[e]:e:[]}function w(){for(var e=0,t=arguments.length;e<t;e++)try{return arguments[e]()}catch(n){}return null}function E(e){if(e==undefined)return!1;if(e.$family)return e.$family.name=="number"&&!isFinite(e)?!1:e.$family.name;if(e.nodeName)switch(e.nodeType){case 1:return"element";case 3:return/\S/.test(e.nodeValue)?"textnode":"whitespace"}else if(typeof e.length=="number"){if(e.callee)return"arguments";if(e.item)return"collection"}return typeof e}function S(e){var t;switch(E(e)){case"object":t={};for(var n in e)t[n]=S(e[n]);break;case"hash":t=new r(e);break;case"array":t=[];for(var i=0,s=e.length;i<s;i++)t[i]=S(e[i]);break;default:return e}return t}function x(e){e instanceof Function&&(e={initialize:e});var t=function(){Object.reset(this);if(t._prototyping)return this;this._current=l;var e=this.initialize?this.initialize.apply(this,arguments):this;return delete this._current,delete this.caller,e}.extend(this);return t.implement(e),t.constructor=x,t.prototype.constructor=t,t}var t={version:"1.2.4",build:"0d9113241a90b9cd5643b926795852a2026710d4"},n=function(e){e=e||{};var t=e.name,r=e.legacy,i=e.protect,s=e.implement,o=e.generics,u=e.initialize,a=e.afterImplement||function(){},f=u||r;o=o!==!1,f.constructor=n,f.$family={name:"native"},r&&u&&(f.prototype=r.prototype),f.prototype.constructor=f;if(t){var l=t.toLowerCase();f.prototype.$family={name:l},n.typize(f,l)}var c=function(e,t,r,s){if(!i||s||!e.prototype[t])e.prototype[t]=r;return o&&n.genericize(e,t,i),a.call(e,t,r),e};return f.alias=function(e,t,n){if(typeof e=="string"){var r=this.prototype[e];if(e=r)return c(this,t,e,n)}for(var i in e)this.alias(i,e[i],t);return this},f.implement=function(e,t,n){if(typeof e=="string")return c(this,e,t,n);for(var r in e)c(this,r,e[r],t);return this},s&&f.implement(s),f};n.genericize=function(e,t,n){(!n||!e[t])&&typeof e.prototype[t]=="function"&&(e[t]=function(){var n=Array.prototype.slice.call(arguments);return e.prototype[t].apply(n.shift(),n)})},n.implement=function(e,t){for(var n=0,r=e.length;n<r;n++)e[n].implement(t)},n.typize=function(e,t){e.type||(e.type=function(e){return E(e)===t})},function(){var e={Array:Array,Date:Date,Function:Function,Number:Number,RegExp:RegExp,String:String};for(var t in e)new n({name:t,initialize:e[t],protect:!0});var r={"boolean":Boolean,"native":n,object:Object};for(var i in r)n.typize(r[i],i);var s={Array:["concat","indexOf","join","lastIndexOf","pop","push","reverse","shift","slice","sort","splice","toString","unshift","valueOf"],String:["charAt","charCodeAt","concat","indexOf","lastIndexOf","match","replace","search","slice","split","substr","substring","toLowerCase","toUpperCase","valueOf"]};for(var o in s)for(var u=s[o].length;u--;)n.genericize(e[o],s[o][u],!0)}();var r=new n({name:"Hash",initialize:function(e){E(e)=="hash"&&(e=S(e.getClean()));for(var t in e)this[t]=e[t];return this}});r.implement({forEach:function(e,t){for(var n in this)this.hasOwnProperty(n)&&e.call(t,this[n],n,this)},getClean:function(){var e={};for(var t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);return e},getLength:function(){var e=0;for(var t in this)this.hasOwnProperty(t)&&e++;return e}}),r.alias("forEach","each"),Array.implement({forEach:function(e,t){for(var n=0,r=this.length;n<r;n++)e.call(t,this[n],n,this)}}),Array.alias("forEach","each");var b=Date.now||function(){return+(new Date)};Array.implement({every:function(e,t){for(var n=0,r=this.length;n<r;n++)if(!e.call(t,this[n],n,this))return!1;return!0},filter:function(e,t){var n=[];for(var r=0,i=this.length;r<i;r++)e.call(t,this[r],r,this)&&n.push(this[r]);return n},clean:function(){return this.filter(a)},indexOf:function(e,t){var n=this.length;for(var r=t<0?Math.max(0,n+t):t||0;r<n;r++)if(this[r]===e)return r;return-1},map:function(e,t){var n=[];for(var r=0,i=this.length;r<i;r++)n[r]=e.call(t,this[r],r,this);return n},some:function(e,t){for(var n=0,r=this.length;n<r;n++)if(e.call(t,this[n],n,this))return!0;return!1},associate:function(e){var t={},n=Math.min(this.length,e.length);for(var r=0;r<n;r++)t[e[r]]=this[r];return t},link:function(e){var t={};for(var n=0,r=this.length;n<r;n++)for(var i in e)if(e[i](this[n])){t[i]=this[n],delete e[i];break}return t},contains:function(e,t){return this.indexOf(e,t)!=-1},extend:function(e){for(var t=0,n=e.length;t<n;t++)this.push(e[t]);return this},getLast:function(){return this.length?this[this.length-1]:null},getRandom:function(){return this.length?this[g(0,this.length-1)]:null},include:function(e){return this.contains(e)||this.push(e),this},combine:function(e){for(var t=0,n=e.length;t<n;t++)this.include(e[t]);return this},erase:function(e){for(var t=this.length;t--;t)this[t]===e&&this.splice(t,1);return this},empty:function(){return this.length=0,this},flatten:function(){var e=[];for(var t=0,n=this.length;t<n;t++){var r=E(this[t]);if(!r)continue;e=e.concat(r=="array"||r=="collection"||r=="arguments"?Array.flatten(this[t]):this[t])}return e},hexToRgb:function(e){if(this.length!=3)return null;var t=this.map(function(e){return e.length==1&&(e+=e),e.toInt(16)});return e?t:"rgb("+t+")"},rgbToHex:function(e){if(this.length<3)return null;if(this.length==4&&this[3]==0&&!e)return"transparent";var t=[];for(var n=0;n<3;n++){var r=(this[n]-0).toString(16);t.push(r.length==1?"0"+r:r)}return e?t:"#"+t.join("")}}),Function.implement({extend:function(e){for(var t in e)this[t]=e[t];return this},create:function(e){var t=this;return e=e||{},function(n){var r=e.arguments;r=r!=undefined?y(r):Array.slice(arguments,e.event?1:0),e.event&&(r=[n||window.event].extend(r));var i=function(){return t.apply(e.bind||null,r)};return e.delay?setTimeout(i,e.delay):e.periodical?setInterval(i,e.periodical):e.attempt?w(i):i()}},run:function(e,t){return this.apply(t,y(e))},pass:function(e,t){return this.create({bind:t,arguments:e})},bind:function(e,t){return this.create({bind:e,arguments:t})},bindWithEvent:function(e,t){return this.create({bind:e,arguments:t,event:!0})},attempt:function(e,t){return this.create({bind:t,arguments:e,attempt:!0})()},delay:function(e,t,n){return this.create({bind:t,arguments:n,delay:e})()},periodical:function(e,t,n){return this.create({bind:t,arguments:n,periodical:e})()}}),Number.implement({limit:function(e,t){return Math.min(t,Math.max(e,this))},round:function(e){return e=Math.pow(10,e||0),Math.round(this*e)/e},times:function(e,t){for(var n=0;n<this;n++)e.call(t,n,this)},toFloat:function(){return parseFloat(this)},toInt:function(e){return parseInt(this,e||10)}}),Number.alias("times","each"),function(e){var t={};e.each(function(e){Number[e]||(t[e]=function(){return Math[e].apply(null,[this].concat(i(arguments)))})}),Number.implement(t)}(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]),String.implement({test:function(e,t){return(typeof e=="string"?new RegExp(e,t):e).test(this)},contains:function(e,t){return t?(t+this+t).indexOf(t+e+t)>-1:this.indexOf(e)>-1},trim:function(){return this.replace(/^\s+|\s+$/g,"")},clean:function(){return this.replace(/\s+/g," ").trim()},camelCase:function(){return this.replace(/-\D/g,function(e){return e.charAt(1).toUpperCase()})},hyphenate:function(){return this.replace(/[A-Z]/g,function(e){return"-"+e.charAt(0).toLowerCase()})},capitalize:function(){return this.replace(/\b[a-z]/g,function(e){return e.toUpperCase()})},escapeRegExp:function(){return this.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(e){return parseInt(this,e||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(e){var t=this.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return t?t.slice(1).hexToRgb(e):null},rgbToHex:function(e){var t=this.match(/\d{1,3}/g);return t?t.rgbToHex(e):null},stripScripts:function(e){var t="",n=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(){return t+=arguments[1]+"\n",""});return e===!0?$exec(t):E(e)=="function"&&e(t,n),n},substitute:function(e,t){return this.replace(t||/\\?\{([^{}]+)\}/g,function(t,n){return t.charAt(0)=="\\"?t.slice(1):e[n]!=undefined?e[n]:""})}}),r.implement({has:Object.prototype.hasOwnProperty,keyOf:function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]===e)return t;return null},hasValue:function(e){return r.keyOf(this,e)!==null},extend:function(e){return r.each(e||{},function(e,t){r.set(this,t,e)},this),this},combine:function(e){return r.each(e||{},function(e,t){r.include(this,t,e)},this),this},erase:function(e){return this.hasOwnProperty(e)&&delete this[e],this},get:function(e){return this.hasOwnProperty(e)?this[e]:null},set:function(e,t){if(!this[e]||this.hasOwnProperty(e))this[e]=t;return this},empty:function(){return r.each(this,function(e,t){delete this[t]},this),this},include:function(e,t){return this[e]==undefined&&(this[e]=t),this},map:function(e,t){var n=new r;return r.each(this,function(r,i){n.set(i,e.call(t,r,i,this))},this),n},filter:function(e,t){var n=new r;return r.each(this,function(r,i){e.call(t,r,i,this)&&n.set(i,r)},this),n},every:function(e,t){for(var n in this)if(this.hasOwnProperty(n)&&!e.call(t,this[n],n))return!1;return!0},some:function(e,t){for(var n in this)if(this.hasOwnProperty(n)&&e.call(t,this[n],n))return!0;return!1},getKeys:function(){var e=[];return r.each(this,function(t,n){e.push(n)}),e},getValues:function(){var e=[];return r.each(this,function(t){e.push(t)}),e},toQueryString:function(e){var t=[];return r.each(this,function(n,i){e&&(i=e+"["+i+"]");var s;switch(E(n)){case"object":s=r.toQueryString(n,i);break;case"array":var o={};n.each(function(e,t){o[t]=e}),s=r.toQueryString(o,i);break;default:s=i+"="+encodeURIComponent(n)}n!=undefined&&t.push(s)}),t.join("&")}}),r.alias({keyOf:"indexOf",hasValue:"contains"}),Function.prototype.protect=function(){return this._protected=!0,this},Object.reset=function(e,t){if(t==null){for(var n in e)Object.reset(e,n);return e}delete e[t];switch(E(e[t])){case"object":var r=function(){};r.prototype=e[t];var i=new r;e[t]=Object.reset(i);break;case"array":e[t]=S(e[t])}return e},(new n({name:"Class",initialize:x})).extend({instantiate:function(e){e._prototyping=!0;var t=new e;return delete e._prototyping,t},wrap:function(e,t,n){return n._origin&&(n=n._origin),function(){if(n._protected&&this._current==null)throw new Error('The method "'+t+'" cannot be called.');var e=this.caller,r=this._current;this.caller=r,this._current=arguments.callee;var i=n.apply(this,arguments);return this._current=r,this.caller=e,i}.extend({_owner:e,_origin:n,_name:t})}}),x.implement({implement:function(e,t){if(E(e)=="object"){for(var n in e)this.implement(n,e[n]);return this}var r=x.Mutators[e];if(r){t=r.call(this,t);if(t==null)return this}var i=this.prototype;switch(E(t)){case"function":if(t._hidden)return this;i[e]=x.wrap(this,e,t);break;case"object":var s=i[e];E(s)=="object"?v(s,t):i[e]=S(t);break;case"array":i[e]=S(t);break;default:i[e]=t}return this}}),x.Mutators={Extends:function(e){this.parent=e,this.prototype=x.instantiate(e),this.implement("parent",function(){var e=this.caller._name,t=this.caller._owner.parent.prototype[e];if(!t)throw new Error('The method "'+e+'" has no parent.');return t.apply(this,arguments)}.protect())},Implements:function(e){y(e).each(function(e){e instanceof Function&&(e=x.instantiate(e)),this.implement(e)},this)}};var T=new x({$chain:[],chain:function(){return this.$chain.extend(Array.flatten(arguments)),this},callChain:function(){return this.$chain.length?this.$chain.shift().apply(this,arguments):!1},clearChain:function(){return this.$chain.empty(),this}}),N=new x({$events:{},addEvent:function(e,t,n){return e=N.removeOn(e),t!=l&&(this.$events[e]=this.$events[e]||[],this.$events[e].include(t),n&&(t.internal=!0)),this},addEvents:function(e){for(var t in e)this.addEvent(t,e[t]);return this},fireEvent:function(e,t,n){return e=N.removeOn(e),!this.$events||!this.$events[e]?this:(this.$events[e].each(function(e){e.create({bind:this,delay:n,arguments:t})()},this),this)},removeEvent:function(e,t){return e=N.removeOn(e),this.$events[e]?(t.internal||this.$events[e].erase(t),this):this},removeEvents:function(e){var t;if(E(e)=="object"){for(t in e)this.removeEvent(t,e[t]);return this}e&&(e=N.removeOn(e));for(t in this.$events){if(e&&e!=t)continue;var n=this.$events[t];for(var r=n.length;r--;r)this.removeEvent(t,n[r])}return this}});N.removeOn=function(e){return e.replace(/^on([A-Z])/,function(e,t){return t.toLowerCase()})};var C=new x({setOptions:function(){this.options=d.run([this.options].extend(arguments));if(!this.addEvent)return this;for(var e in this.options){if(E(this.options[e])!="function"||!/^on[A-Z]/.test(e))continue;this.addEvent(e,this.options[e]),delete this.options[e]}return this}});return{Class:x,Options:C}});