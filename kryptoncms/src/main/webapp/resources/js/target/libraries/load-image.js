(function(e){var t=function(e,n,r){var i,s,o=document.createElement("img");return o.onerror=n,o.onload=function(){!s||r&&r.noRevoke||t.revokeObjectURL(s),n(t.scale(o,r))},window.Blob&&e instanceof Blob||window.File&&e instanceof File?(i=s=t.createObjectURL(e),o._type=e.type):"string"==typeof e&&(i=e),i?(o.src=i,o):t.readFile(e,function(e){var t=e.target;t&&t.result?o.src=t.result:n(e)})},n=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;t.detectSubsampling=function(e){var t,n,r=e.width,i=e.height;return r*i>1048576?(t=document.createElement("canvas"),t.width=t.height=1,n=t.getContext("2d"),n.drawImage(e,-r+1,0),0===n.getImageData(0,0,1,1).data[3]):!1},t.detectVerticalSquash=function(e,t){var n,r,i,s,o,u=document.createElement("canvas"),a=u.getContext("2d");for(u.width=1,u.height=t,a.drawImage(e,0,0),n=a.getImageData(0,0,1,t).data,r=0,i=t,s=t;s>r;)o=n[4*(s-1)+3],0===o?i=s:r=s,s=i+r>>1;return s/t||1},t.renderImageToCanvas=function(e,n,r,i){var s,o,u,a,f,l,c,h,p=e.width,d=e.height,v=n.getContext("2d"),m=1024,g=document.createElement("canvas");for(v.save(),t.detectSubsampling(e)&&(p/=2,d/=2),s=t.detectVerticalSquash(e,d),g.width=g.height=m,o=g.getContext("2d"),u=Math.ceil(m*r/p),a=Math.ceil(m*i/d/s),l=0,h=0;d>h;){for(f=0,c=0;p>c;)o.clearRect(0,0,m,m),o.drawImage(e,-c,-h),v.drawImage(g,0,0,m,m,f,l,u,a),c+=m,f+=u;h+=m,l+=a}v.restore(),g=o=null},t.scale=function(e,n){n=n||{};var r=document.createElement("canvas"),i=e.width,s=e.height,o=Math.max((n.minWidth||i)/i,(n.minHeight||s)/s);return o>1&&(i=Math.ceil(i*o),s=Math.ceil(s*o)),o=Math.min((n.maxWidth||i)/i,(n.maxHeight||s)/s),1>o&&(i=Math.ceil(i*o),s=Math.ceil(s*o)),e.getContext||n.canvas&&r.getContext?(r.width=i,r.height=s,"image/jpeg"===e._type?t.renderImageToCanvas(e,r,i,s):r.getContext("2d").drawImage(e,0,0,i,s),r):(e.width=i,e.height=s,e)},t.createObjectURL=function(e){return n?n.createObjectURL(e):!1},t.revokeObjectURL=function(e){return n?n.revokeObjectURL(e):!1},t.readFile=function(e,t){if(window.FileReader&&FileReader.prototype.readAsDataURL){var n=new FileReader;return n.onload=n.onerror=t,n.readAsDataURL(e),n}return!1},"function"==typeof define&&define.amd?define([],function(){return t}):e.loadImage=t})(this);