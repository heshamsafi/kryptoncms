define(["jquery"],function(e){jQuery=e,e.browser={msie:navigator.userAgent.match(/msie/i)!=null},jQuery.atmosphere=function(){jQuery(window).unload(function(){jQuery.atmosphere.unsubscribe()});var e=function(e){var t,n=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,r={};while(t=n.exec(e))r[t[1]]=t[2];return r};return{version:"1.0",requests:[],callbacks:[],onError:function(e){},onClose:function(e){},onOpen:function(e){},onMessage:function(e){},onReconnect:function(e,t){},onMessagePublished:function(e){},onTransportFailure:function(e){},AtmosphereRequest:function(t){function d(){s=0,c=!0,p=!1,h=0,o=null,u=null,a=null,f=null}function v(){Y(),d()}function m(e){v(),n=jQuery.extend(n,e),s=jQuery.atmosphere.guid()}function g(){return n.webSocketImpl!=null||window.WebSocket||window.MozWebSocket}function y(){return window.EventSource}function b(){n.transport!="websocket"&&n.transport!="sse"?(w("opening",n.transport,n),D()):n.transport=="websocket"?g()?k(!1):O("Websocket is not supported, using request.fallbackTransport ("+n.fallbackTransport+")"):n.transport=="sse"&&(y()?C(!1):O("Server Side Events(SSE) is not supported, using request.fallbackTransport ("+n.fallbackTransport+")"))}function w(e,t,n){n.close=function(){G(),n.reconnect=!1},r.request=n;var i=r.state;r.state=e,r.status=200;var s=r.transport;r.transport=t,Q(),r.state=i,r.transport=s}function E(e){var t=n;e!=null&&typeof e!="undefined"&&(t=e);var r=t.url,i=t.data;t.attachHeadersAsQueryString&&(r=M(t),i!=""&&(r+="&X-Atmosphere-Post-Body="+i),i=""),l=jQuery.ajax({url:r,type:t.method,dataType:"jsonp",error:function(e,n,r){e.status<300&&t.requestCount++<t.maxRequest?H(l,t):$(n,"error",e.status,t.transport)},jsonp:"jsonpTransport",success:function(e){if(t.requestCount++<t.maxRequest){t.executeCallbackBeforeReconnect&&H(l,t);var r=e.message;if(r!=null&&typeof r!="string")try{r=jQuery.stringifyJSON(r)}catch(i){}$(r,"messageReceived",200,t.transport),t.executeCallbackBeforeReconnect||H(l,t)}else jQuery.atmosphere.log(n.logLevel,["JSONP reconnect maximum try reached "+n.requestCount]),L()},data:t.data,beforeSend:function(e){P(e,t,!1)}})}function S(e){var t=n;e!=null&&typeof e!="undefined"&&(t=e);var r=t.url,i=t.data;t.attachHeadersAsQueryString&&(r=M(t),i!=""&&(r+="&X-Atmosphere-Post-Body="+i),i=""),l=jQuery.ajax({url:r,type:t.method,error:function(e,n,r){e.status<300&&t.requestCount++<t.maxRequest?H(l,t):$(n,"error",e.status,t.transport)},success:function(e,r,i){t.requestCount++<t.maxRequest?(t.executeCallbackBeforeReconnect&&H(l,t),$(e,"messageReceived",200,t.transport),t.executeCallbackBeforeReconnect||H(l,t)):(jQuery.atmosphere.log(n.logLevel,["AJAX reconnect maximum try reached "+n.requestCount]),L())},data:t.data,beforeSend:function(e){P(e,t,!1)}})}function x(e){return n.webSocketImpl!=null?n.webSocketImpl:window.WebSocket?new WebSocket(e):new MozWebSocket(e)}function T(){var e=n.url;return e=M(),decodeURI(jQuery('<a href="'+e+'"/>')[0].href.replace(/^http/,"ws"))}function N(){var e=n.url;return e=M(),e}function C(e){r.transport="sse";var t=N(n.url);jQuery.atmosphere.log(n.logLevel,["Invoking executeSSE"]),n.logLevel=="debug"&&jQuery.atmosphere.debug("Using URL: "+t),e&&w("re-opening","sse",n);if(!n.reconnect){u!=null&&u.close();return}u=new EventSource(t,{withCredentials:n.withCredentials}),n.connectTimeout>0&&(n.id=setTimeout(function(){e||u.close()},n.connectTimeout)),u.onopen=function(t){n.logLevel=="debug"&&jQuery.atmosphere.debug("SSE successfully opened"),e||w("opening","sse",n),e=!0,n.method=="POST"&&(r.state="messageReceived",u.send(n.data))},u.onmessage=function(e){r.state="messageReceived",r.status=200;var e=e.data,t=A(e,n,r);jQuery.trim(e).length==0&&(t=!0),t||(Q(),r.responseBody="")},u.onerror=function(t){clearTimeout(n.id),r.state="closed",r.responseBody="",r.status=e?200:501,Q(),p?jQuery.atmosphere.log(n.logLevel,["SSE closed normally"]):e?n.reconnect&&r.transport=="sse"&&(h++<n.maxRequest?(n.requestCount=h,r.responseBody="",C(!0)):(u.close(),jQuery.atmosphere.log(n.logLevel,["SSE reconnect maximum try reached "+n.requestCount]),L())):O("SSE failed. Downgrading to fallback transport and resending")}}function k(e){r.transport="websocket";var t=T(n.url),i=!1;jQuery.atmosphere.log(n.logLevel,["Invoking executeWebSocket"]),n.logLevel=="debug"&&jQuery.atmosphere.debug("Using URL: "+t),e&&w("re-opening","websocket",n);if(!n.reconnect){o!=null&&o.close();return}o=x(t),n.connectTimeout>0&&(n.id=setTimeout(function(){if(!e){var t={code:1002,reason:"",wasClean:!1};o.onclose(t);try{o.close()}catch(n){}}},n.connectTimeout)),o.onopen=function(t){n.logLevel=="debug"&&jQuery.atmosphere.debug("Websocket successfully opened"),e||w("opening","websocket",n),e=!0,n.method=="POST"&&(r.state="messageReceived",o.send(n.data))},o.onmessage=function(e){e.data.indexOf("parent.callback")!=-1&&jQuery.atmosphere.log(n.logLevel,["parent.callback no longer supported with 0.8 version and up. Please upgrade"]),r.state="messageReceived",r.status=200;var e=e.data,t=A(e,n,r);t||(Q(),r.responseBody="")},o.onerror=function(e){clearTimeout(n.id)},o.onclose=function(t){if(i)return;var s=t.reason;if(s==="")switch(t.code){case 1e3:s="Normal closure; the connection successfully completed whatever purpose for which it was created.";break;case 1001:s="The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.";break;case 1002:s="The endpoint is terminating the connection due to a protocol error.";break;case 1003:s="The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data).";break;case 1004:s="The endpoint is terminating the connection because a data frame was received that is too large.";break;case 1005:s="Unknown: no status code was provided even though one was expected.";break;case 1006:s="Connection was closed abnormally (that is, with no close frame being sent)."}jQuery.atmosphere.warn("Websocket closed, reason: "+s),jQuery.atmosphere.warn("Websocket closed, wasClean: "+t.wasClean),r.state="closed",r.responseBody="",r.status=e?200:501,Q(),clearTimeout(n.id),i=!0,p?jQuery.atmosphere.log(n.logLevel,["Websocket closed normally"]):e?n.reconnect&&r.transport=="websocket"&&(n.reconnect&&h++<n.maxRequest?(n.requestCount=h,r.responseBody="",k(!0)):(jQuery.atmosphere.log(n.logLevel,["Websocket reconnect maximum try reached "+n.requestCount]),jQuery.atmosphere.warn("Websocket error, reason: "+t.reason),L())):O("Websocket failed. Downgrading to Comet and resending")}}function L(){r.state="error",r.responseBody="",r.status=500,Q()}function A(e,t,n){if(t.trackMessageLength){var r=e.indexOf(t.messageDelimiter),i=n.expectedBodySize;r!=-1&&(i=e.substring(0,r),e=e.substring(r+1),n.expectedBodySize=i),r!=-1?n.responseBody=e:n.responseBody+=e;if(n.responseBody.length!=i)return!0}else n.responseBody=e;return!1}function O(e){jQuery.atmosphere.log(n.logLevel,[e]),typeof n.onTransportFailure!="undefined"?n.onTransportFailure(e,n):typeof jQuery.atmosphere.onTransportFailure!="undefined"&&jQuery.atmosphere.onTransportFailure(e,n),n.transport=n.fallbackTransport;if(n.reconnect&&n.transport!="none"||n.transport==null)n.method=n.fallbackMethod,r.transport=n.fallbackTransport,b()}function M(e){var t=n;e!=null&&typeof e!="undefined"&&(t=e);var i=t.url;return t.attachHeadersAsQueryString?i.indexOf("X-Atmosphere-Framework")!=-1?i:(i+=i.indexOf("?")!=-1?"&":"?",i+="X-Atmosphere-tracking-id="+s,i+="&X-Atmosphere-Framework="+jQuery.atmosphere.version,i+="&X-Atmosphere-Transport="+t.transport,t.trackMessageLength&&(i+="&X-Atmosphere-TrackMessageSize=true"),t.lastTimestamp!=undefined?i+="&X-Cache-Date="+t.lastTimestamp:i+="&X-Cache-Date=0",t.contentType!=""&&(i+="&Content-Type="+t.contentType),jQuery.each(t.headers,function(n,s){var o=jQuery.isFunction(s)?s.call(this,t,e,r):s;o!=null&&(i+="&"+encodeURIComponent(n)+"="+encodeURIComponent(o))}),i):i}function _(){var e;if(jQuery.browser.msie){var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(var n=0;n<t.length;n++)try{e=new ActiveXObject(t[n])}catch(r){}}else window.XMLHttpRequest&&(e=new XMLHttpRequest);return e}function D(t){var i=n;if(t!=null||typeof t!="undefined")i=t;if(i.transport=="jsonp"||i.enableXDR&&jQuery.atmosphere.checkCORSSupport()){E(i);return}if(i.transport=="ajax"){S(t);return}if(i.transport=="streaming"&&jQuery.browser.msie){i.enableXDR&&window.XDomainRequest?B(i):F(i);return}if(i.enableXDR&&window.XDomainRequest){B(i);return}if(i.reconnect&&i.requestCount++<i.maxRequest){var s=_();P(s,i,!0),i.suspend&&(a=s),i.transport!="polling"&&(r.transport=i.transport);var o=!1;jQuery.browser.msie||(s.onerror=function(){o=!0;try{r.status=XMLHttpRequest.status}catch(e){r.status=404}r.state="error",Q(),s.abort(),a=null}),s.onreadystatechange=function(){if(p)return;var t=!1,o=!1;if(i.transport=="streaming"&&i.readyState>2&&s.readyState==4){i.readyState=0,i.lastIndex=0,H(s,i,!0);return}i.readyState=s.readyState,s.readyState==4?jQuery.browser.msie?o=!0:i.transport=="streaming"?o=!0:i.transport=="long-polling"&&(o=!0,clearTimeout(i.id)):!jQuery.browser.msie&&s.readyState==3&&s.status==200&&i.transport!="long-polling"?o=!0:clearTimeout(i.id);if(o){var u=s.responseText;if(!n.dropAtmosphereHeaders)try{var a=s.getResponseHeader("X-Cache-Date");if(a!=null||a!=undefined)n.lastTimestamp=a.split(" ").pop()}catch(f){}this.previousLastIndex=i.lastIndex;if(i.transport=="streaming"){var l=u.substring(i.lastIndex,u.length);r.isJunkEnded=!0,i.lastIndex==0&&l.indexOf("<!-- Welcome to the Atmosphere Framework.")!=-1&&(r.isJunkEnded=!1);if(!r.isJunkEnded){var c="<!-- EOD -->",h=c.length,d=l.indexOf(c)+h;d>h&&d!=l.length?r.responseBody=l.substring(d):t=!0}else{var v=u.substring(i.lastIndex,u.length);t=A(v,i,r)}i.lastIndex=u.length,jQuery.browser.opera&&jQuery.atmosphere.iterate(function(){if(s.responseText.length>i.lastIndex){try{r.status=s.status,r.headers=e(s.getAllResponseHeaders()),n.headers&&jQuery.each(n.headers,function(e){var t=s.getResponseHeader(e);t&&(r.headers[e]=t)})}catch(t){r.status=404}r.state="messageReceived",r.responseBody=s.responseText.substring(i.lastIndex),i.lastIndex=s.responseText.length,Q(),i.transport=="streaming"&&s.responseText.length>i.maxStreamingLength&&(s.abort(),P(s,i,!0))}},0);if(t)return}else t=A(u,i,r),i.lastIndex=u.length;try{r.status=s.status,r.headers=e(s.getAllResponseHeaders()),n.headers&&jQuery.each(n.headers,function(e){var t=s.getResponseHeader(e);t&&(r.headers[e]=t)})}catch(f){r.status=404}i.suspend?r.state=r.status==0?"closed":"messageReceived":r.state="messagePublished",i.executeCallbackBeforeReconnect||H(s,i,!1),r.responseBody.indexOf("parent.callback")!=-1&&jQuery.atmosphere.log(i.logLevel,["parent.callback no longer supported with 0.8 version and up. Please upgrade"]),Q(),i.executeCallbackBeforeReconnect&&H(s,i,!1),i.transport=="streaming"&&u.length>i.maxStreamingLength&&(s.abort(),P(s,i,!0))}},s.send(i.data),i.suspend&&(i.id=setTimeout(function(){c&&(s.abort(),m(i),b())},i.timeout)),c=!0}else jQuery.atmosphere.log(i.logLevel,["Max re-connection reached."]),L()}function P(e,t,i){var o=jQuery.atmosphere.prepareURL(t.url);i&&(e.open(t.method,o,!0),t.connectTimeout>-1&&(t.id=setTimeout(function(){t.requestCount==0&&(e.abort(),$("Connect timeout","closed",200,t.transport))},t.connectTimeout))),n.withCredentials&&"withCredentials"in e&&(e.withCredentials=!0),n.dropAtmosphereHeaders||(e.setRequestHeader("X-Atmosphere-Framework",jQuery.atmosphere.version),e.setRequestHeader("X-Atmosphere-Transport",t.transport),t.lastTimestamp!=undefined?e.setRequestHeader("X-Cache-Date",t.lastTimestamp):e.setRequestHeader("X-Cache-Date",0),t.trackMessageLength&&e.setRequestHeader("X-Atmosphere-TrackMessageSize","true"),t.contentType!=""&&e.setRequestHeader("Content-Type",t.contentType),e.setRequestHeader("X-Atmosphere-tracking-id",s),jQuery.each(t.headers,function(n,s){var o=jQuery.isFunction(s)?s.call(this,e,t,i,r):s;o!=null&&e.setRequestHeader(n,o)}))}function H(e,t,n){if(n||t.suspend&&e.status==200&&t.transport!="streaming"&&c)w("re-opening",t.transport,t),t.reconnect&&D()}function B(e){f=j(e),f.open()}function j(e){var t=n;e!=null&&typeof e!="undefined"&&(t=e);var r="",i=t.transport,s=0,o=function(e){var t=e.responseText,n=!1;t.indexOf("<!-- Welcome to the Atmosphere Framework.")!=-1&&(n=!0);if(n){var r="<!-- EOD -->",o=r.length,u=t.indexOf(r)+o;t=t.substring(u+s),s+=t.length}$(t,"messageReceived",200,i)},u=new window.XDomainRequest,a=t.rewriteURL||function(e){var t=/(?:^|;\s*)(JSESSIONID|PHPSESSID)=([^;]*)/.exec(document.cookie);switch(t&&t[1]){case"JSESSIONID":return e.replace(/;jsessionid=[^\?]*|(\?)|$/,";jsessionid="+t[2]+"$1");case"PHPSESSID":return e.replace(/\?PHPSESSID=[^&]*&?|\?|$/,"?PHPSESSID="+t[2]+"&").replace(/&$/,"")}};return u.onprogress=function(){o(u)},u.onerror=function(){$(u.responseText,"error",500,i)},u.onload=function(){r!=u.responseText&&o(u),t.transport=="long-polling"&&D()},{open:function(){t.method=="POST"&&(t.attachHeadersAsQueryString=!0);var e=M(t);t.method=="POST"&&(e+="&X-Atmosphere-Post-Body="+t.data),u.open(t.method,a(e)),u.send(),t.connectTimeout>-1&&(t.id=setTimeout(function(){t.requestCount==0&&(u.abort(),$("Connect timeout","closed",200,t.transport))},t.connectTimeout))},close:function(){u.abort(),$(u.responseText,"closed",200,i)}}}function F(e){f=I(e),f.open()}function I(e){var t=n;e!=null&&typeof e!="undefined"&&(t=e);var i,s=new window.ActiveXObject("htmlfile");s.open(),s.close();var o=t.url;return t.transport!="polling"&&(r.transport=t.transport),{open:function(){var e=s.createElement("iframe");o=M(t),t.data!=""&&(o+="&X-Atmosphere-Post-Body="+t.data),o=jQuery.atmosphere.prepareURL(o),e.src=o,s.body.appendChild(e);var n=e.contentDocument||e.contentWindow.document;i=jQuery.atmosphere.iterate(function(){try{if(!n.firstChild)return;if(n.readyState==="complete")try{jQuery.noop(n.fileSize)}catch(e){return $("Connection Failure","error",500,t.transport),!1}var s=n.body?n.body.lastChild:n,o=function(){var e=s.cloneNode(!0);e.appendChild(n.createTextNode("."));var t=e.innerText,r=!0;t.indexOf("<!-- Welcome to the Atmosphere Framework.")==-1&&(r=!1);if(r){var i="<!-- EOD -->",o=i.length,u=t.indexOf(i)+o;t=t.substring(u)}return t.substring(0,t.length-1)};if(!jQuery.nodeName(s,"pre")){var u=n.head||n.getElementsByTagName("head")[0]||n.documentElement||n,a=n.createElement("script");a.text="document.write('<plaintext>')",u.insertBefore(a,u.firstChild),u.removeChild(a),s=n.body.lastChild}return $(o(),"opening",200,t.transport),i=jQuery.atmosphere.iterate(function(){var e=o();e.length>t.lastIndex&&(r.status=200,$(e,"messageReceived",200,t.transport),s.innerText="",t.lastIndex=0);if(n.readyState==="complete")return $("","re-opening",200,t.transport),F(t),!1},null),!1}catch(f){jQuery.atmosphere.error(f)}})},close:function(){i&&i(),s.execCommand("Stop"),$("","closed",200,t.transport)}}}function q(e){a!=null||u!=null?R(e):f!=null?U(e):l!=null?z(e):o!=null&&V(e)}function R(e){var t=X(e);D(t)}function U(e){R(e)}function z(e){R(e)}function W(e){var t=e;return typeof t=="object"&&(t=e.data),t}function X(e){var t=W(e),r={connected:!1,timeout:6e4,method:"POST",url:n.url,contentType:n.contentType,headers:{},reconnect:!0,callback:null,data:t,suspend:!1,maxRequest:60,logLevel:"info",requestCount:0,transport:"polling"};return typeof e=="object"&&(r=jQuery.extend(r,e)),r}function V(e){var t=W(e),r;try{n.webSocketUrl!=null?r=n.webSocketPathDelimiter+n.webSocketUrl+n.webSocketPathDelimiter+t:r=t,o.send(r)}catch(i){o.onclose=function(e){},o.close(),O("Websocket failed. Downgrading to Comet and resending "+r),R(e)}}function $(e,t,i,s){if(t=="messageReceived"&&A(e,n,r))return;r.transport=s,r.status=i,r.expectedBodySize==-1&&(r.responseBody=e),r.state=t,Q()}function J(e){K(e,n),K(e,jQuery.atmosphere)}function K(e,t){switch(e.state){case"messageReceived":typeof t.onMessage!="undefined"&&t.onMessage(e);break;case"error":typeof t.onError!="undefined"&&t.onError(e);break;case"opening":typeof t.onOpen!="undefined"&&t.onOpen(e);break;case"messagePublished":typeof t.onMessagePublished!="undefined"&&t.onMessagePublished(e);break;case"re-opening":typeof t.onReconnect!="undefined"&&t.onReconnect(n,e);break;case"closed":typeof t.onClose!="undefined"&&t.onClose(e)}}function Q(){var e=function(e,t){t(r)},t=typeof r.responseBody=="string"?r.responseBody.split(n.messageDelimiter):new Array(r.responseBody);for(i=0;i<t.length;i++){if(t.length>1&&t[i].length==0)continue;r.responseBody=jQuery.trim(t[i]),J(r);if(jQuery.atmosphere.callbacks.length>0){jQuery.atmosphere.debug("Invoking "+jQuery.atmosphere.callbacks.length+" global callbacks: "+r.state);try{jQuery.each(jQuery.atmosphere.callbacks,e)}catch(s){jQuery.atmosphere.log(n.logLevel,["Callback exception"+s])}}if(typeof n.callback=="function"){n.logLevel=="debug"&&jQuery.atmosphere.debug("Invoking request callbacks");try{n.callback(r)}catch(s){jQuery.atmosphere.log(n.logLevel,["Callback exception"+s])}}}}function G(){n.reconnect=!1,r.request=n,c=!1,p=!0,r.state="unsubscribe",r.responseBody="",r.status=408,Q(),Y()}function Y(){f!=null&&(f.close(),f=null),l!=null&&(l.abort(),l=null),a!=null&&(a.abort(),a=null),o!=null&&(o.close(),o=null),u!=null&&(u.close(),u=null)}var n={timeout:3e5,method:"GET",headers:{},contentType:"",callback:null,url:"",data:"",suspend:!0,maxRequest:60,reconnect:!0,maxStreamingLength:1e7,lastIndex:0,logLevel:"info",requestCount:0,fallbackMethod:"GET",fallbackTransport:"streaming",transport:"long-polling",webSocketImpl:null,webSocketUrl:null,webSocketPathDelimiter:"@@",enableXDR:!0,rewriteURL:!0,attachHeadersAsQueryString:!0,executeCallbackBeforeReconnect:!1,readyState:0,lastTimestamp:0,withCredentials:!0,trackMessageLength:!1,messageDelimiter:"|",connectTimeout:-1,dropAtmosphereHeaders:!1,onError:function(e){},onClose:function(e){},onOpen:function(e){},onMessage:function(e){},onReconnect:function(e,t){},onMessagePublished:function(e){},onTransportFailure:function(e,t){}},r={status:200,responseBody:"",expectedBodySize:-1,headers:[],state:"messageReceived",transport:"polling",error:null,request:null,id:0},s=0,o=null,u=null,a=null,f=null,l=null,c=!0,h=0,p=!1;m(t),this.subscribe=function(e){m(e),b()},this.execute=function(){b()},this.invokeCallback=function(){Q()},this.close=function(){G()},this.getUrl=function(){return n.url},this.push=function(e){q(e)},this.response=r},subscribe:function(e,t,n,r){typeof n=="function"&&jQuery.atmosphere.addCallback(n),typeof e!="string"?r=e:r.url=e,r.url+="?";for(var i=0;i<t.length;i++)r.url+=t[i].key+"="+encodeURIComponent(t[i].value);console.log(r);var s=new jQuery.atmosphere.AtmosphereRequest(r);return s.execute(),jQuery.atmosphere.requests[jQuery.atmosphere.requests.length]=s,s},addCallback:function(e){jQuery.inArray(e,jQuery.atmosphere.callbacks)==-1&&jQuery.atmosphere.callbacks.push(e)},removeCallback:function(e){var t=jQuery.inArray(e,jQuery.atmosphere.callbacks);t!=-1&&jQuery.atmosphere.callbacks.splice(t,1)},unsubscribe:function(){if(jQuery.atmosphere.requests.length>0)for(var e=0;e<jQuery.atmosphere.requests.length;e++)jQuery.atmosphere.requests[e].close(),clearTimeout(jQuery.atmosphere.requests[e].id);jQuery.atmosphere.requests=[],jQuery.atmosphere.callbacks=[]},unsubscribeUrl:function(e){var t=-1;if(jQuery.atmosphere.requests.length>0)for(var n=0;n<jQuery.atmosphere.requests.length;n++){var r=jQuery.atmosphere.requests[n];if(r.getUrl()==e){r.close(),clearTimeout(r.id),t=n;break}}t>=0&&jQuery.atmosphere.requests.splice(t,1)},publish:function(e){typeof e.callback=="function"&&jQuery.atmosphere.addCallback(callback),e.transport="polling";var t=new jQuery.atmosphere.AtmosphereRequest(e);return jQuery.atmosphere.requests[jQuery.atmosphere.requests.length]=t,t},checkCORSSupport:function(){if(jQuery.browser.msie&&!window.XDomainRequest)return!0;if(jQuery.browser.opera)return!0;var e=navigator.userAgent.toLowerCase(),t=e.indexOf("android")>-1;return t?!0:!1},S4:function(){return((1+Math.random())*65536|0).toString(16).substring(1)},guid:function(){return jQuery.atmosphere.S4()+jQuery.atmosphere.S4()+"-"+jQuery.atmosphere.S4()+"-"+jQuery.atmosphere.S4()+"-"+jQuery.atmosphere.S4()+"-"+jQuery.atmosphere.S4()+jQuery.atmosphere.S4()+jQuery.atmosphere.S4()},prepareURL:function(e){var t=jQuery.now(),n=e.replace(/([?&])_=[^&]*/,"$1_="+t);return n+(n===e?(/\?/.test(e)?"&":"?")+"_="+t:"")},param:function(e){return jQuery.param(e,jQuery.ajaxSettings.traditional)},iterate:function(e,t){var n;return t=t||0,function r(){n=setTimeout(function(){if(e()===!1)return;r()},t)}(),function(){clearTimeout(n)}},log:function(e,t){if(window.console){var n=window.console[e];typeof n=="function"&&n.apply(window.console,t)}},warn:function(){jQuery.atmosphere.log("warn",arguments)},info:function(){jQuery.atmosphere.log("info",arguments)},debug:function(){jQuery.atmosphere.log("debug",arguments)},error:function(){jQuery.atmosphere.log("error",arguments)}}}(),function(e){function r(e){return'"'+e.replace(t,function(e){var t=n[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"'}function i(e){return e<10?"0"+e:e}function s(e,t){var n,o,u,a,l=t[e],c=typeof l;l&&typeof l=="object"&&typeof l.toJSON=="function"&&(l=l.toJSON(e),c=typeof l);switch(c){case"string":return r(l);case"number":return isFinite(l)?String(l):"null";case"boolean":return String(l);case"object":if(!l)return"null";switch(Object.prototype.toString.call(l)){case"[object Date]":return isFinite(l.valueOf())?'"'+l.getUTCFullYear()+"-"+i(l.getUTCMonth()+1)+"-"+i(l.getUTCDate())+"T"+i(l.getUTCHours())+":"+i(l.getUTCMinutes())+":"+i(l.getUTCSeconds())+"Z"+'"':"null";case"[object Array]":u=l.length,a=[];for(n=0;n<u;n++)a.push(s(n,l)||"null");return"["+a.join(",")+"]";default:a=[];for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(o=s(n,l),o&&a.push(r(n)+":"+o));return"{"+a.join(",")+"}"}}}var t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};e.stringifyJSON=function(e){return window.JSON&&window.JSON.stringify?window.JSON.stringify(e):s("",{"":e})}}(jQuery)});