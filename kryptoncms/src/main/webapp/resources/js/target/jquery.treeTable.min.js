(function(e){function t(e){var t=[];while(e=u(e))t[t.length]=e[0];return t}function n(t){return e(t).siblings("tr."+a.childPrefix+t[0].id)}function r(e){var t=parseInt(e[0].style.paddingLeft,10);return isNaN(t)?f:t}function i(t,s){var o=e(t.children("td")[a.treeColumn]);o[0].style.paddingLeft=r(o)+s+"px",n(t).each(function(){i(e(this),s)})}function s(t){if(!t.hasClass("initialized")){t.addClass("initialized");var i=n(t);!t.hasClass("parent")&&i.length>0&&t.addClass("parent");if(t.hasClass("parent")){var s=e(t.children("td")[a.treeColumn]),o=r(s)+a.indent;i.each(function(){e(this).children("td")[a.treeColumn].style.paddingLeft=o+"px"});if(a.expandable){s.prepend('<span style="margin-left: -'+a.indent+"px; padding-left: "+a.indent+'px" class="expander"></span>'),e(s[0].firstChild).click(function(){t.toggleBranch()}),a.clickableNodeNames&&(s[0].style.cursor="pointer",e(s).click(function(e){e.target.className!="expander"&&t.toggleBranch()}));if(a.persist){var u=a.persistCookiePrefix+t.attr("id");e.cookie(u)=="true"&&t.addClass("expanded")}!t.hasClass("expanded")&&!t.hasClass("collapsed")&&t.addClass(a.initialState),t.hasClass("expanded")&&t.expand()}}}}function o(t,r){t.insertAfter(r),n(t).reverse().each(function(){o(e(this),t[0])})}function u(t){var n=t[0].className.split(" ");for(var r=0;r<n.length;r++)if(n[r].match(a.childPrefix))return e(t).siblings("#"+n[r].substring(a.childPrefix.length));return null}var a,f;e.fn.treeTable=function(t){return a=e.extend({},e.fn.treeTable.defaults,t),this.each(function(){e(this).addClass("treeTable").find("tbody tr").each(function(){if(!e(this).hasClass("initialized")){var t=e(this)[0].className.search(a.childPrefix)==-1;t&&isNaN(f)&&(f=parseInt(e(e(this).children("td")[a.treeColumn]).css("padding-left"),10)),!t&&a.expandable&&a.initialState=="collapsed"&&e(this).addClass("ui-helper-hidden"),(!a.expandable||t)&&s(e(this))}})})},e.fn.treeTable.defaults={childPrefix:"child-of-",clickableNodeNames:!1,expandable:!0,indent:19,initialState:"collapsed",onNodeShow:null,onNodeHide:null,treeColumn:0,persist:!1,persistCookiePrefix:"treeTable_"},e.fn.collapse=function(){return e(this).addClass("collapsed"),n(e(this)).each(function(){e(this).hasClass("collapsed")||e(this).collapse(),e(this).addClass("ui-helper-hidden"),e.isFunction(a.onNodeHide)&&a.onNodeHide.call(this)}),this},e.fn.expand=function(){return e(this).removeClass("collapsed").addClass("expanded"),n(e(this)).each(function(){s(e(this)),e(this).is(".expanded.parent")&&e(this).expand(),e(this).removeClass("ui-helper-hidden"),e.isFunction(a.onNodeShow)&&a.onNodeShow.call(this)}),this},e.fn.reveal=function(){return e(t(e(this)).reverse()).each(function(){s(e(this)),e(this).expand().show()}),this},e.fn.appendBranchTo=function(n){var r=e(this),s=u(r),f=e.map(t(e(n)),function(e){return e.id});return e.inArray(r[0].id,f)==-1&&(!s||n.id!=s[0].id)&&n.id!=r[0].id&&(i(r,t(r).length*a.indent*-1),s&&r.removeClass(a.childPrefix+s[0].id),r.addClass(a.childPrefix+n.id),o(r,n),i(r,t(r).length*a.indent)),this},e.fn.reverse=function(){return this.pushStack(this.get().reverse(),arguments)},e.fn.toggleBranch=function(){e(this).hasClass("collapsed")?e(this).expand():e(this).removeClass("expanded").collapse();if(a.persist){var t=a.persistCookiePrefix+e(this).attr("id");e.cookie(t,e(this).hasClass("expanded")?"true":null)}return this}})(jQuery);