define(["jquery","libraries/mootools-base","ContextMenu.class","Notifier.class","SocketHandler.class","Ajaxifier.class","libraries/jquery.ui/selectable"],function(e,t,n,r,i,s){var o=new t.Class({$scaffoldTable:null,contextMenu:null,socketHandler:null,initialize:function(t){this.ajaxifier=t;var n=this;n.$scaffoldTable=e("table[data-enable-selectable] tbody"),n.$scaffoldTable.selectable({filter:"tr",cancel:"a"}),e("#delete").click(function(t){n.$scaffoldTable.find("tr.ui-selected").each(function(t,r){var i=e(r);$form=i.parents("form");var s={className:$form.attr("className"),id:i.attr("data-entity-id"),action:"delete"};n.socketHandler.push(JSON.stringify(s))})}),e("#edit").click(function(){var t=n.$scaffoldTable.find("tr.ui-selected"),r=t.parents("form"),i=t.attr("data-entity-id");e("#genericModal").load(r.attr("data-edit-action")+i,function(){var t=e("#genericModal form");n.ajaxifier.formSubmitHandler(t,n.socketHandler),s.getInstance().passiveReload()})}),e("#create").click(function(){e("#genericModal").load(e("#scaffoldForm").attr("data-edit-action"),function(){var t=e("#genericModal form");n.ajaxifier.formSubmitHandler(t,n.socketHandler)})}),n.socket()},createOrModifyRow:function(t,n){var r=e("#scaffoldForm");if(t.match("Menu")!=null){var i=e("#admin_nav #"+n.id);i.attr({href:n.url}).text(n.name)}if(t.match(r.attr("classname")+"$")==null)return;var s=r.find("table"),o=s.find("tr[data-entity-id="+n.id+"]");o.find("td").each(function(t,r){var i=e(r),s=i.attr("data-attr");typeof n[s]!="undefined"&&i.find("span").html(n[s].toString())})},deleteRow:function(t,n){var r=e("#scaffoldForm");t.match("Menu")!=null&&e("#admin_nav #"+n).parent("li").slideUp(200,function(){e(this).remove()});if(t.match(r.attr("classname")+"$")==null)return;var i=r.find("table"),s=i.find("tr[data-entity-id="+n+"]");s.find("td").wrapInner('<div style="display: block;" />').parent().find("td > div").slideUp(200,function(){s.remove()})},socket:function(){var t=this,n=e("#scaffoldForm");if(n.length<1){if(t.socketHandler==null)return;t.socketHandler.close(),t.socketHandler=null;return}t.socketHandler=(new i({url:DOMAIN_CONFIGURATIONS.BASE_URL+"form/echo"})).setOnMessageHandler(function(e){var n=JSON.parse(e.responseBody);if(n.action=="delete")t.deleteRow(n.className,n.id);else{var r=JSON.parse(n.actualEntity);t.createOrModifyRow(n.className,r)}}).subscribe()}});return o});